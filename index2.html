<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuoLive</title>
    <style>
        /* å†…è”æ ·å¼ä»¥ç¡®ä¿CSSåŠ è½½ */
        :root {
            --floor-color: #f0e4d3;
            --wall-color: #c8bead;
            --accent-color: #7fb069;
            --text-color: #4a4a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            background-color: #e8f4e5;
            color: var(--text-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        button {
            background-color: var(--accent-color);
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 10px;
        }

        button:hover {
            background-color: #6a9e57;
        }

        .controls {
            display: flex;
            align-items: center;
        }

        /* ç­‰è·è§†å›¾æ ·å¼ */
        .game-container {
            height: 500px;
            position: relative;
            overflow: hidden;
            background-color: #c4e3c2;
            border-radius: 12px;
        }

        .isometric-world {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotateX(60deg) rotateZ(45deg);
            transform-style: preserve-3d;
        }

        .house {
            display: grid;
            grid-template-columns: repeat(5, 100px);
            grid-gap: 5px;
        }

        .room {
            width: 100px;
            height: 100px;
            background-color: var(--floor-color);
            border: 2px solid var(--wall-color);
            position: relative;
            border-radius: 5px;
        }

        /* è§’è‰²æ ·å¼ */
        .character {
            width: 30px;
            height: 30px;
            position: absolute;
            bottom: 10px;
            left: 35px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }

        .character-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }

        /* æ¯ä¸ªè§’è‰²çš„é¢œè‰² */
        .character[data-id="AB"] .character-inner { background-color: #FF6B6B; }
        .character[data-id="IR"] .character-inner { background-color: #4ECDC4; }
        .character[data-id="RP"] .character-inner { background-color: #FFD166; }
        .character[data-id="GR"] .character-inner { background-color: #70C1B3; }
        .character[data-id="CG"] .character-inner { background-color: #B8336A; }

        /* å®¶å…·æ ·å¼ */
        .furniture {
            position: absolute;
            z-index: 5;
        }

        .bed {
            width: 40px;
            height: 25px;
            background-color: #A5D8FF;
            border-radius: 5px;
            top: 15px;
            left: 10px;
        }

        .desk {
            width: 30px;
            height: 20px;
            background-color: #c0a080;
            border-radius: 3px;
            top: 50px;
            right: 10px;
        }

        /* å¯¹è¯æ°”æ³¡ */
        .speech-bubble {
            position: absolute;
            background: white;
            border-radius: 10px;
            padding: 5px 8px;
            font-size: 12px;
            bottom: 35px;
            left: -30px;
            width: 90px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }

        .speech-bubble.active {
            opacity: 1;
        }

        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -7px;
            left: 45px;
            border-width: 8px 8px 0;
            border-style: solid;
            border-color: white transparent;
        }

        /* ç¡çœ çŠ¶æ€ */
        .sleeping .character-inner:after {
            content: "ğŸ’¤";
            position: absolute;
            top: -15px;
            right: -10px;
            font-size: 15px;
        }

        /* é€šçŸ¥é¢æ¿ */
        .notification-panel {
            margin-top: 20px;
            background-color: white;
            border-radius: 12px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        #notifications-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .notification-item {
            padding: 8px;
            background-color: #f8f8f8;
            border-left: 4px solid var(--accent-color);
            border-radius: 4px;
            font-size: 14px;
        }

        /* ä¸Šä¸‹æ–‡èœå• */
        .context-menu {
            display: none;
            position: absolute;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .context-menu ul {
            list-style: none;
        }

        .context-menu li {
            padding: 8px 15px;
            cursor: pointer;
        }

        .context-menu li:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DuoLive</h1>
            <div class="controls">
                <button id="language-toggle">English</button>
                <button id="import-calendar" data-lang-key="import_calendar">å¯¼å…¥æ—¥ç¨‹</button>
                <button id="load-demo" data-lang-key="load_demo">åŠ è½½ç¤ºä¾‹</button>
                <span id="current-time"></span>
            </div>
        </header>
        
        <div class="game-container">
            <!-- ç­‰è·è§†å›¾çš„æ¸¸æˆä¸–ç•Œ -->
            <div class="isometric-world">
                <div class="house">
                    <!-- æˆ¿é—´å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <div class="notification-panel">
            <h3 data-lang-key="notifications">é€šçŸ¥</h3>
            <div id="notifications-list"></div>
        </div>
        
        <input type="file" id="ics-upload" accept=".ics" style="display: none;">
    </div>

    <div id="character-menu" class="context-menu">
        <ul>
            <li data-action="status" data-lang-key="check_status">æŸ¥çœ‹çŠ¶æ€</li>
            <li data-action="remind" data-lang-key="send_reminder">å‘é€æé†’</li>
            <li data-action="poke" data-lang-key="poke">æˆ³ä¸€æˆ³</li>
            <li data-action="chat" data-lang-key="chat">èŠå¤©</li>
        </ul>
    </div>

    <script>
        // è¯­è¨€ç¿»è¯‘å¯¹è±¡
        const translations = {
            'zh-CN': {
                'import_calendar': 'å¯¼å…¥æ—¥ç¨‹',
                'load_demo': 'åŠ è½½ç¤ºä¾‹',
                'notifications': 'é€šçŸ¥',
                'check_status': 'æŸ¥çœ‹çŠ¶æ€',
                'send_reminder': 'å‘é€æé†’',
                'poke': 'æˆ³ä¸€æˆ³',
                'chat': 'èŠå¤©',
                'success_import': 'æˆåŠŸå¯¼å…¥ {0} ä¸ªæ—¥ç¨‹äº‹ä»¶',
                'import_failed': 'å¯¼å…¥æ—¥ç¨‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼',
                'reminded_event': 'ä½ æé†’äº† {0} å…³äºä»–ä»¬çš„æ—¥ç¨‹å®‰æ’',
                'dont_poke': 'å˜¿! åˆ«æˆ³æˆ‘!',
                'my_status': 'æˆ‘ç°åœ¨çš„çŠ¶æ€æ˜¯: {0}',
                'will_remember': 'è°¢è°¢æé†’ï¼Œæˆ‘ä¼šè®°å¾—æˆ‘çš„æ—¥ç¨‹çš„!',
                'upcoming_event': '{0} çš„äº‹ä»¶ï¼š{1}ï¼Œå³å°†åœ¨ {2} å¼€å§‹',
                'my_event': 'æˆ‘çš„äº‹ä»¶ "{0}" å³å°†å¼€å§‹!',
                'notifications_enabled': 'é€šçŸ¥æƒé™å·²å¯ç”¨',
                'demo_loaded': 'ç¤ºä¾‹æ—¥ç¨‹å·²åŠ è½½',
                'idle': 'ç©ºé—²',
                'sleeping': 'ç¡è§‰',
                'working': 'å·¥ä½œ',
                'meeting': 'å¼€ä¼š'
            },
            'en-US': {
                'import_calendar': 'Import Calendar',
                'load_demo': 'Load Demo',
                'notifications': 'Notifications',
                'check_status': 'Check Status',
                'send_reminder': 'Send Reminder',
                'poke': 'Poke',
                'chat': 'Chat',
                'success_import': 'Successfully imported {0} events',
                'import_failed': 'Failed to import calendar, please check file format',
                'reminded_event': 'You reminded {0} about their schedule',
                'dont_poke': "Hey! Don't poke me!",
                'my_status': 'My current status is: {0}',
                'will_remember': "Thanks for the reminder, I'll remember my schedule!",
                'upcoming_event': "{0}'s event: {1}, starts at {2}",
                'my_event': 'My event "{0}" is about to start!',
                'notifications_enabled': 'Notification permissions enabled',
                'demo_loaded': 'Demo schedule loaded',
                'idle': 'idle',
                'sleeping': 'sleeping',
                'working': 'working',
                'meeting': 'in a meeting'
            }
        };

        // AIå“åº”çš„ç¿»è¯‘
        const aiResponses = {
            'zh-CN': [
                "ä½ å¥½å•Šï¼æœ‰ä»€ä¹ˆæˆ‘èƒ½å¸®ä½ çš„å—ï¼Ÿ",
                "æˆ‘ç°åœ¨æœ‰ç‚¹å¿™ï¼Œç­‰ä¸€ä¸‹å†èŠå¯ä»¥å—ï¼Ÿ",
                "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œä¸æ˜¯å—ï¼Ÿ",
                "æˆ‘åœ¨æ€è€ƒäººç”Ÿçš„æ„ä¹‰...",
                "ä½ çŸ¥é“æˆ‘æœ€å–œæ¬¢çš„é¢œè‰²æ˜¯ä»€ä¹ˆå—ï¼Ÿæ˜¯è“è‰²!"
            ],
            'en-US': [
                "Hello there! How can I help you today?",
                "I'm a bit busy right now, can we chat later?",
                "Beautiful weather today, isn't it?",
                "I'm contemplating the meaning of life...",
                "Do you know what my favorite color is? It's blue!"
            ]
        };

        // æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¾…åŠ©å‡½æ•°
        function formatString(str, ...args) {
            return str.replace(/{(\d+)}/g, function(match, number) {
                return typeof args[number] != 'undefined' ? args[number] : match;
            });
        }

        // ç®€å•çš„ ICS æ–‡ä»¶è§£æå™¨
        class ICSParser {
            static parse(icsData) {
                const events = [];
                const lines = icsData.split('\n');
                let currentEvent = null;

                for (let line of lines) {
                    line = line.trim();

                    if (line === 'BEGIN:VEVENT') {
                        currentEvent = {
                            userId: '',
                            startTime: null,
                            description: ''
                        };
                    } else if (line.startsWith('SUMMARY:') && currentEvent) {
                        currentEvent.description = line.substring(8);
                    } else if (line.startsWith('DTSTART:') && currentEvent) {
                        // è§£ææ—¶é—´æ ¼å¼ï¼šYYYYMMDDTHHMMSSZ
                        const dateStr = line.substring(8);
                        const year = dateStr.substring(0, 4);
                        const month = dateStr.substring(4, 6) - 1; // æœˆä»½æ˜¯ 0-11
                        const day = dateStr.substring(6, 8);
                        const hour = dateStr.substring(9, 11);
                        const minute = dateStr.substring(11, 13);
                        currentEvent.startTime = new Date(year, month, day, hour, minute);
                    } else if (line.startsWith('DESCRIPTION:UserID:') && currentEvent) {
                        currentEvent.userId = line.substring(19);
                    } else if (line === 'END:VEVENT' && currentEvent) {
                        if (currentEvent.startTime && currentEvent.userId) {
                            events.push(currentEvent);
                        }
                        currentEvent = null;
                    }
                }

                return events;
            }
        }

        // DuoLive ä¸»åº”ç”¨
        class DuoLive {
            constructor() {
                this.characters = {
                    'AB': { status: 'idle', room: 0 },
                    'RP': { status: 'idle', room: 1 },
                    'IR': { status: 'idle', room: 2 },
                    'GR': { status: 'idle', room: 3 },
                    'CG': { status: 'idle', room: 4 }
                };
                
                this.events = [];
                this.notifications = [];
                this.selectedCharacter = null;
                this.currentLanguage = 'zh-CN';
                
                this.init();
            }
            
            init() {
                console.log("Initializing DuoLive...");
                
                // åˆ›å»ºæˆ¿å±‹å¸ƒå±€
                this.createHouseLayout();
                
                // æ·»åŠ è§’è‰²
                this.addCharacters();
                
                // è®¾ç½®å®æ—¶æ—¶é’Ÿ
                this.setupClock();
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
                this.setupEventListeners();
                
                // è¯·æ±‚é€šçŸ¥æƒé™
                this.requestNotificationPermission();
                
                console.log("DuoLive initialized!");
            }
            
            createHouseLayout() {
                const house = document.querySelector('.house');
                if (!house) {
                    console.error("House element not found!");
                    return;
                }
                
                // åˆ›å»º5ä¸ªæˆ¿é—´
                for (let i = 0; i < 5; i++) {
                    const room = document.createElement('div');
                    room.className = 'room';
                    room.dataset.roomId = i;
                    
                    // æ·»åŠ å®¶å…·
                    const bed = document.createElement('div');
                    bed.className = 'furniture bed';
                    room.appendChild(bed);
                    
                    const desk = document.createElement('div');
                    desk.className = 'furniture desk';
                    room.appendChild(desk);
                    
                    house.appendChild(room);
                }
            }
            
            addCharacters() {
                for (const [id, data] of Object.entries(this.characters)) {
                    const room = document.querySelector(`.room[data-room-id="${data.room}"]`);
                    if (!room) {
                        console.error(`Room ${data.room} not found for character ${id}`);
                        continue;
                    }
                    
                    // åˆ›å»ºè§’è‰²å…ƒç´ 
                    const character = document.createElement('div');
                    character.className = 'character';
                    character.dataset.id = id;
                    
                    const characterInner = document.createElement('div');
                    characterInner.className = 'character-inner';
                    characterInner.textContent = id;
                    character.appendChild(characterInner);
                    
                    // æ·»åŠ å¯¹è¯æ°”æ³¡
                    const speechBubble = document.createElement('div');
                    speechBubble.className = 'speech-bubble';
                    character.appendChild(speechBubble);
                    
                    room.appendChild(character);
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    character.addEventListener('click', (e) => this.handleCharacterClick(e, id));
                }
            }
            
            setupClock() {
                const timeElement = document.getElementById('current-time');
                if (!timeElement) {
                    console.error("Time element not found!");
                    return;
                }
                
                // æ›´æ–°æ—¶é—´å’Œè§’è‰²çŠ¶æ€
                const updateTime = () => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString();
                    timeElement.textContent = timeString;
                    
                    // æ›´æ–°è§’è‰²çŠ¶æ€åŸºäºæ—¶é—´
                    this.updateCharacterStates(now);
                    
                    // æ£€æŸ¥äº‹ä»¶é€šçŸ¥
                    this.checkEventNotifications(now);
                };
                
                // ç«‹å³æ›´æ–°ä¸€æ¬¡
                updateTime();
                // æ¯ç§’æ›´æ–°ä¸€æ¬¡
                setInterval(updateTime, 1000);
            }
            
            updateCharacterStates(now) {
                const hour = now.getHours();
                
                // æ™šä¸Š10ç‚¹åˆ°æ—©ä¸Š6ç‚¹è§’è‰²ç¡è§‰
                for (const [id, data] of Object.entries(this.characters)) {
                    const character = document.querySelector(`.character[data-id="${id}"]`);
                    if (!character) continue;
                    
                    if (hour >= 22 || hour < 6) {
                        character.classList.add('sleeping');
                        this.characters[id].status = 'sleeping';
                    } else {
                        character.classList.remove('sleeping');
                        this.characters[id].status = 'idle';
                    }
                }
            }
            
            setupEventListeners() {
                // å¯¼å…¥æ—¥ç¨‹æŒ‰é’®
                const importBtn = document.getElementById('import-calendar');
                if (importBtn) {
                    importBtn.addEventListener('click', () => {
                        console.log("Import calendar clicked");
                        const uploadInput = document.getElementById('ics-upload');
                        if (uploadInput) {
                            uploadInput.click();
                        } else {
                            console.error("ICS upload input not found!");
                        }
                    });
                } else {
                    console.error("Import calendar button not found!");
                }
                
                // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
                const uploadInput = document.getElementById('ics-upload');
                if (uploadInput) {
                    uploadInput.addEventListener('change', (e) => {
                        console.log("File selected");
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const icsData = e.target.result;
                                this.importEvents(icsData);
                            };
                            reader.readAsText(file);
                        }
                    });
                }
                
                // è¯­è¨€åˆ‡æ¢æŒ‰é’®
                const langToggle = document.getElementById('language-toggle');
                if (langToggle) {
                    langToggle.addEventListener('click', () => {
                        console.log("Language toggle clicked");
                        this.toggleLanguage();
                    });
                } else {
                    console.error("Language toggle button not found!");
                }
                
                // åŠ è½½ç¤ºä¾‹æŒ‰é’®
                const demoBtn = document.getElementById('load-demo');
                if (demoBtn) {
                    demoBtn.addEventListener('click', () => {
                        console.log("Load demo clicked");
                        this.loadDemoSchedule();
                    });
                } else {
                    console.error("Load demo button not found!");
                }
                
                // å¤„ç†è§’è‰²èœå•é€‰é¡¹
                const menuItems = document.querySelectorAll('#character-menu li');
                menuItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const action = item.dataset.action;
                        console.log(`Menu action: ${action} for character: ${this.selectedCharacter}`);
                        if (this.selectedCharacter) {
                            this.handleCharacterAction(this.selectedCharacter, action);
                        }
                        this.hideContextMenu();
                    });
                });
                
                // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.character') && !e.target.closest('#character-menu')) {
                        this.hideContextMenu();
                    }
                });
            }
            
            toggleLanguage() {
                // åˆ‡æ¢è¯­è¨€
                this.currentLanguage = this.currentLanguage === 'zh-CN' ? 'en-US' : 'zh-CN';
                const toggleButton = document.getElementById('language-toggle');
                if (toggleButton) {
                    toggleButton.textContent = this.currentLanguage === 'zh-CN' ? 'English' : 'ä¸­æ–‡';
                }
                
                // æ›´æ–°æ‰€æœ‰æ–‡æœ¬
                this.updateAllTexts();
            }
            
            updateAllTexts() {
                // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ data-lang-key å±æ€§çš„å…ƒç´ 
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.dataset.langKey;
                    if (translations[this.currentLanguage][key]) {
                        element.textContent = translations[this.currentLanguage][key];
                    }
                });
            }
            
            handleCharacterClick(event, characterId) {
                event.stopPropagation();
                
                // ä¿å­˜å½“å‰é€‰ä¸­çš„è§’è‰²
                this.selectedCharacter = characterId;
                console.log(`Character clicked: ${characterId}`);
                
                // æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå•
                const menu = document.getElementById('character-menu');
                if (menu) {
                    menu.style.display = 'block';
                    menu.style.left = `${event.pageX}px`;
                    menu.style.top = `${event.pageY}px`;
                } else {
                    console.error("Character menu not found!");
                }
            }
            
            hideContextMenu() {
                const menu = document.getElementById('character-menu');
                if (menu) {
                    menu.style.display = 'none';
                }
                this.selectedCharacter = null;
            }
            
            handleCharacterAction(characterId, action) {
                switch (action) {
                    case 'status':
                        this.showCharacterStatus(characterId);
                        break;
                    case 'remind':
                        this.remindCharacter(characterId);
                        break;
                    case 'poke':
                        this.pokeCharacter(characterId);
                        break;
                    case 'chat':
                        this.chatWithAI(characterId);
                        break;
                }
            }
            
            showCharacterStatus(characterId) {
                const status = this.characters[characterId].status;
                const statusText = translations[this.currentLanguage][status] || status;
                const message = formatString(translations[this.currentLanguage]['my_status'], statusText);
                this.showSpeechBubble(characterId, message);
            }
            
            remindCharacter(characterId) {
                this.showSpeechBubble(characterId, translations[this.currentLanguage]['will_remember']);
                this.addNotification(formatString(translations[this.currentLanguage]['reminded_event'], characterId));
            }
            
            pokeCharacter(characterId) {
                const character = document.querySelector(`.character[data-id="${characterId}"]`);
                if (!character) return;
                
                // æ·»åŠ æŠ–åŠ¨åŠ¨ç”»
                character.style.transform = 'translateX(5px)';
                setTimeout(() => {
                    character.style.transform = 'translateX(-5px)';
                    setTimeout(() => {
                        character.style.transform = 'translateX(0)';
                    }, 100);
                }, 100);
                
                this.showSpeechBubble(characterId, translations[this.currentLanguage]['dont_poke']);
            }
            
            chatWithAI(characterId) {
                // è·å–å½“å‰è¯­è¨€çš„AIå›åº”
                const responses = aiResponses[this.currentLanguage];
                const response = responses[Math.floor(Math.random() * responses.length)];
                this.showSpeechBubble(characterId, response);
            }
            
            showSpeechBubble(characterId, text) {
                const character = document.querySelector(`.character[data-id="${characterId}"]`);
                if (!character) return;
                
                const speechBubble = character.querySelector('.speech-bubble');
                if (!speechBubble) return;
                
                speechBubble.textContent = text;
                speechBubble.classList.add('active');
                
                // 5ç§’åéšè—
                setTimeout(() => {
                    speechBubble.classList.remove('active');
                }, 5000);
            }
            
            importEvents(icsData) {
                try {
                    const events = ICSParser.parse(icsData);
                    this.events = this.events.concat(events);
                    this.addNotification(formatString(translations[this.currentLanguage]['success_import'], events.length));
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰è¿‘æœŸçš„äº‹ä»¶
                    const now = new Date();
                    this.checkEventNotifications(now);
                } catch (error) {
                    console.error('å¯¼å…¥æ—¥ç¨‹æ—¶å‡ºé”™:', error);
                    this.addNotification(translations[this.currentLanguage]['import_failed'], 'error');
                }
            }
            
            checkEventNotifications(now) {
                for (const event of this.events) {
                    // å¦‚æœäº‹ä»¶åœ¨æœªæ¥5åˆ†é’Ÿå†…ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰æé†’è¿‡
                    const timeDiff = (event.startTime.getTime() - now.getTime()) / (1000 * 60);
                    
                    if (timeDiff > 0 && timeDiff <= 5 && !event.notified) {
                        this.notifyEvent(event);
                        event.notified = true;
                    }
                }
            }
            
            notifyEvent(event) {
                // æ˜¾ç¤ºé€šçŸ¥
                const timeString = event.startTime.toLocaleTimeString();
                this.addNotification(formatString(
                    translations[this.currentLanguage]['upcoming_event'], 
                    event.userId, 
                    event.description, 
                    timeString
                ));
                
                // è®©ç›¸åº”çš„è§’è‰²è¯´è¯
                this.showSpeechBubble(event.userId, formatString(
                    translations[this.currentLanguage]['my_event'], 
                    event.description
                ));
                
                // å¦‚æœæµè§ˆå™¨é€šçŸ¥å·²å¯ç”¨ï¼Œä¹Ÿå‘é€æµè§ˆå™¨é€šçŸ¥
                if (this.notificationsEnabled) {
                    new Notification(`DuoLive - ${event.userId}`, {
                        body: `${event.description} - ${event.startTime.toLocaleTimeString()}`
                    });
                }
            }
            
            addNotification(message, type = 'info') {
                const notificationsList = document.getElementById('notifications-list');
                if (!notificationsList) {
                    console.error("Notifications list not found!");
                    return;
                }
                
                const notification = document.createElement('div');
                notification.className = `notification-item ${type}`;
                notification.textContent = message;
                
                notificationsList.prepend(notification);
                
                // åªä¿ç•™æœ€è¿‘çš„10æ¡é€šçŸ¥
                this.notifications.push(message);
                if (this.notifications.length > 10) {
                    this.notifications.shift();
                    if (notificationsList.children.length > 10) {
                        notificationsList.removeChild(notificationsList.lastChild);
                    }
                }
            }
            
            requestNotificationPermission() {
                this.notificationsEnabled = false;
                
                if ('Notification' in window) {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            this.notificationsEnabled = true;
                            this.addNotification(translations[this.currentLanguage]['notifications_enabled']);
                        }
                    });
                }
            }
            
            // åŠ è½½ç¤ºä¾‹æ—¥ç¨‹
            loadDemoSchedule() {
                console.log("Loading demo schedule...");
                // åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æ—¥ç¨‹ï¼ŒåŒ…å«å½“å‰æ—¶é—´é™„è¿‘çš„äº‹ä»¶
